# üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç AiAntiblokBot

## ‚úÖ –ß—Ç–æ —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

–í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ–≥–ª–∞—Å–Ω–æ –¢–ó:
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ `data/state.json`
- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤–µ—Ç–æ–∫ (115-–§–ó/–ó–°–ö/161-–§–ó/–Ω–∞–ª–æ–≥–∏/–ø—Ä–∏—Å—Ç–∞–≤—ã)
- ‚úÖ RAG: 3-6 —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤ –∏–∑ KB
- ‚úÖ GigaChat –¥–ª—è —Å–≤–æ–±–æ–¥–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤
- ‚úÖ –°–±–æ—Ä –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ ‚≠ê1-‚≠ê6 + –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
- ‚úÖ –ê–¥–º–∏–Ω-–∫–æ–º–∞–Ω–¥—ã `/inbox` –∏ `/reply`
- ‚úÖ –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π HTML –¥–∞—à–±–æ—Ä–¥
- ‚úÖ –ê–Ω—Ç–∏-–∑–∞—Ü–∏–∫–ª–∏–≤–∞–Ω–∏–µ
- ‚úÖ –ú–µ–Ω—é –†–∞–∑–¥–∞—Ç–∫–∞/–®–∞–±–ª–æ–Ω—ã/–ö—É—Ä—Å—ã

## üìã –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `.env` —Ñ–∞–π–ª

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã:
```env
BOT_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω_–±–æ—Ç–∞
GIGACHAT_AUTH_KEY=–≤–∞—à_–∫–ª—é—á
GIGACHAT_SCOPE=GIGACHAT_API_PERS
GIGACHAT_CA_BUNDLE=data/ca/ca_bundle.pem
ADMIN_IDS=123456789  # –≤–∞—à Telegram user ID
```

### 2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç

```bash
# –í venv
source venv/bin/activate  # –∏–ª–∏: venv\Scripts\activate –Ω–∞ Windows
python test_bot_setup.py
```

–°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç:
- ‚úÖ –ò–º–ø–æ—Ä—Ç—ã –±–∏–±–ª–∏–æ—Ç–µ–∫
- ‚úÖ –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- ‚úÖ –ù–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–æ–≤
- ‚úÖ content.json
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ state.json
- ‚úÖ build_dashboard.py

## üéØ –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ü—Ä—è–º–æ–π –∑–∞–ø—É—Å–∫ (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

```bash
source venv/bin/activate
python bot.py
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ß–µ—Ä–µ–∑ watchdog (–¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)

```bash
bash data/watchdog.sh
```

Watchdog –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –ü—Ä–æ–≤–µ—Ä–∏—Ç, –Ω–µ –∑–∞–ø—É—â–µ–Ω –ª–∏ –±–æ—Ç —É–∂–µ
- –ó–∞–ø—É—Å—Ç–∏—Ç –±–æ—Ç –≤ —Ñ–æ–Ω–µ
- –°–æ—Ö—Ä–∞–Ω–∏—Ç PID –≤ `data/bot.pid`

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ß–µ—Ä–µ–∑ cron (–∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É)

–î–æ–±–∞–≤—å—Ç–µ –≤ crontab:
```bash
* * * * * /–ø–æ–ª–Ω—ã–π/–ø—É—Ç—å/–∫/AiAntiblokBot/data/watchdog.sh >> /–ø–æ–ª–Ω—ã–π/–ø—É—Ç—å/–∫/AiAntiblokBot/logs/cron_run.log 2>&1
```

## üìä –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∞—à–±–æ—Ä–¥–∞

```bash
python scripts/build_dashboard.py
```

–î–∞—à–±–æ—Ä–¥ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω –≤ `dashboard/index.html`

–î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–æ–±–∞–≤—å—Ç–µ –≤ crontab:
```bash
*/5 * * * * /–ø–æ–ª–Ω—ã–π/–ø—É—Ç—å/–∫/AiAntiblokBot/venv/bin/python /–ø–æ–ª–Ω—ã–π/–ø—É—Ç—å/–∫/AiAntiblokBot/scripts/build_dashboard.py
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π

### 1. –ë–∞–∑–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã
- `/start` - –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
- `/status` - —Å—Ç–∞—Ç—É—Å –±–æ—Ç–∞
- `/inbox` - —Å–ø–∏—Å–æ–∫ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤)
- `/reply <thread_id> <—Ç–µ–∫—Å—Ç>` - –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤)

### 2. –ú–µ–Ω—é
- –ù–∞–∂–º–∏—Ç–µ "üìé –†–∞–∑–¥–∞—Ç–∫–∞" - –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –∏–∑ content.json
- –ù–∞–∂–º–∏—Ç–µ "üßæ –®–∞–±–ª–æ–Ω—ã" - –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫
- –ù–∞–∂–º–∏—Ç–µ "üìö –ö—É—Ä—Å—ã" - –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫

### 3. –í–æ–ø—Ä–æ—Å—ã
- –ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å: "—á—Ç–æ —Ç–∞–∫–æ–µ –ú–§–ö?"
- –ë–æ—Ç –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—Ç–∏—Ç—å —á–µ—Ä–µ–∑ RAG+GigaChat
- –ü–æ—Å–ª–µ –æ—Ç–≤–µ—Ç–∞ –ø–æ—è–≤–∏—Ç—Å—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å ‚≠ê1-‚≠ê6
- –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ—Å—Ç–∞–≤–∏—Ç—å –æ—Ü–µ–Ω–∫—É
- –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `data/state.json` - –¥–æ–ª–∂–µ–Ω —Å–æ–∑–¥–∞—Ç—å—Å—è —Ñ–∞–π–ª
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `data/feedback.jsonl` - –¥–æ–ª–∂–Ω—ã —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è –æ—Ü–µ–Ω–∫–∏
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `data/dialogs.jsonl` - –¥–æ–ª–∂–Ω—ã —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è –¥–∏–∞–ª–æ–≥–∏

### 5. –ê–¥–º–∏–Ω-–∫–æ–º–∞–Ω–¥—ã (–µ—Å–ª–∏ –≤—ã –∞–¥–º–∏–Ω)
- `/inbox` - –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
- `/reply <thread_id> —Ç–µ—Å—Ç` - –¥–æ–ª–∂–µ–Ω –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏
- `logs/bot.log` - –ª–æ–≥–∏ –±–æ—Ç–∞
- `logs/watchdog.log` - –ª–æ–≥–∏ watchdog

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –∑–∞–ø—É—â–µ–Ω –ª–∏ –±–æ—Ç
ps aux | grep bot.py

# –ò–ª–∏ —á–µ—Ä–µ–∑ PID —Ñ–∞–π–ª
cat data/bot.pid
ps -p $(cat data/bot.pid)
```

## ‚ö†Ô∏è –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ë–æ—Ç –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `.env` - –≤—Å–µ —Ç–æ–∫–µ–Ω—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã?
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ venv - –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –ª–∏?
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `tail -f logs/bot.log`

### GigaChat –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `GIGACHAT_AUTH_KEY` –≤ `.env`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `GIGACHAT_CA_BUNDLE` - —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç?
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

### –î–∞—à–±–æ—Ä–¥ –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ `data/feedback.jsonl` –∏ `data/dialogs.jsonl`
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤—Ä—É—á–Ω—É—é: `python scripts/build_dashboard.py`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å—å –≤ `dashboard/`

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç: `python test_bot_setup.py`
2. ‚úÖ –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞: `python bot.py` (–¥–ª—è —Ç–µ—Å—Ç–∞) –∏–ª–∏ —á–µ—Ä–µ–∑ watchdog
3. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
4. ‚úÖ –ù–∞—Å—Ç—Ä–æ–π—Ç–µ cron –¥–ª—è –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞
5. ‚úÖ –ù–∞—Å—Ç—Ä–æ–π—Ç–µ cron –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–∞—à–±–æ—Ä–¥–∞

## üÜò –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `logs/bot.log`
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç: `python test_bot_setup.py`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—Å–µ —Ñ–∞–π–ª—ã –Ω–∞ –º–µ—Å—Ç–µ
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

---

**–ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üéâ

